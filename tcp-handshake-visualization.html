<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹å¯è§†åŒ– | TCP Handshake & Termination Visualization</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 20px;
            background-color: #f5f7fa;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        h1 {
            color: #2c3e50;
            text-align: center;
            border-bottom: 3px solid #3498db;
            padding-bottom: 10px;
        }
        h2 {
            color: #34495e;
            margin-top: 40px;
            padding-left: 10px;
            border-left: 4px solid #3498db;
        }
        .tcp-intro {
            background: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        .tcp-intro h3 {
            color: #2980b9;
            margin-top: 0;
        }
        .feature-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 15px;
            margin: 15px 0;
        }
        .feature-item {
            background: white;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #e74c3c;
        }
        .diagram-container {
            margin: 30px 0;
            padding: 20px;
            background: #fafbfc;
            border-radius: 8px;
            border: 1px solid #e1e8ed;
        }
        .step-explanation {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 6px;
            padding: 15px;
            margin: 15px 0;
        }
        .step-explanation h4 {
            color: #856404;
            margin-top: 0;
        }
        .signal-info {
            display: inline-block;
            background: #007bff;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            margin: 0 3px;
        }
        .seq-info {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            margin: 0 3px;
        }
        .state-info {
            display: inline-block;
            background: #6f42c1;
            color: white;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.9em;
            margin: 0 3px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>TCPä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹å¯è§†åŒ–<br><small>TCP Three-Way Handshake & Four-Way Termination Visualization</small></h1>
        
        <div class="tcp-intro">
            <h3>ğŸ”— TCPåè®®ç‰¹æ€§ (TCP Protocol Characteristics)</h3>
            <div class="feature-list">
                <div class="feature-item">
                    <strong>é¢å‘è¿æ¥ (Connection-Oriented)</strong><br>
                    éœ€è¦å…ˆå»ºç«‹è¿æ¥æ‰èƒ½ä¼ è¾“æ•°æ®ï¼Œå¦‚åŒæ‰“ç”µè¯éœ€è¦å¯¹æ–¹æ¥å¬
                </div>
                <div class="feature-item">
                    <strong>å¯é ä¼ è¾“ (Reliable Transmission)</strong><br>
                    ä¿è¯æ•°æ®åŒ…æŒ‰é¡ºåºåˆ°è¾¾ï¼Œæ— ä¸¢å¤±ã€æ— é‡å¤ã€æ— é”™è¯¯
                </div>
                <div class="feature-item">
                    <strong>ä¸€å¯¹ä¸€é€šä¿¡ (Point-to-Point)</strong><br>
                    è¿æ¥å¯¹è±¡æ•°é‡åªèƒ½æ˜¯ä¸€å¯¹ä¸€ï¼Œä¸æ”¯æŒå¹¿æ’­æˆ–å¤šæ’­
                </div>
                <div class="feature-item">
                    <strong>ä¼ è¾“æ•ˆç‡è¾ƒä½ (Lower Efficiency)</strong><br>
                    ç›¸æ¯”UDPéœ€è¦æ›´å¤šå¼€é”€ï¼Œä½†æä¾›æ›´é«˜çš„å¯é æ€§ä¿è¯
                </div>
            </div>
        </div>

        <h2>ğŸ¤ ä¸‰æ¬¡æ¡æ‰‹ (Three-Way Handshake)</h2>
        <p><strong>ç›®çš„</strong>ï¼šç¡®ä¿åŒæ–¹éƒ½ç¡®è®¤è‡ªå·±çš„å‘é€å’Œæ¥æ”¶èƒ½åŠ›ï¼Œå»ºç«‹å¯é è¿æ¥</p>
        
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant "å®¢æˆ·ç«¯<br/>Client" as Client
    participant "æœåŠ¡å™¨<br/>Server" as Server
    
    Note over Client: CLOSEDçŠ¶æ€<br/>å‡†å¤‡å‘èµ·è¿æ¥
    Note over Server: LISTENçŠ¶æ€<br/>ç­‰å¾…è¿æ¥è¯·æ±‚
    
    Client->>Server: â‘ SYN=1, seq=x<br/>åŒæ­¥ä¿¡å·+éšæœºåºåˆ—å·
    Note over Client: SYN-SENTçŠ¶æ€<br/>å·²å‘é€åŒæ­¥è¯·æ±‚
    
    Server->>Client: â‘¡SYN=1, ACK=1<br/>seq=y, ack=x+1<br/>åŒæ­¥+ç¡®è®¤ä¿¡å·
    Note over Server: SYN-RCVDçŠ¶æ€<br/>å·²æ¥æ”¶å¹¶å›å¤
    
    Client->>Server: â‘¢ACK=1, ack=y+1<br/>ç¡®è®¤ä¿¡å·
    Note over Client: ESTABLISHEDçŠ¶æ€<br/>è¿æ¥å»ºç«‹æˆåŠŸ
    Note over Server: ESTABLISHEDçŠ¶æ€<br/>è¿æ¥å»ºç«‹æˆåŠŸ
    
    Note over Client,Server: ğŸ‰ è¿æ¥å»ºç«‹å®Œæˆï¼Œå¯ä»¥å¼€å§‹æ•°æ®ä¼ è¾“
            </div>
        </div>

        <div class="step-explanation">
            <h4>ğŸ“‹ ä¸‰æ¬¡æ¡æ‰‹è¯¦ç»†æ­¥éª¤</h4>
            <p><strong>ç¬¬ä¸€æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘é€ <span class="signal-info">SYN=1</span> åŒæ­¥ä¿¡å·ï¼Œéšæœºç”Ÿæˆåºåˆ—å· <span class="seq-info">seq=x</span>ï¼Œè¿›å…¥ <span class="state-info">SYN-SENT</span> çŠ¶æ€</p>
            <p><strong>ç¬¬äºŒæ¬¡æ¡æ‰‹</strong>ï¼šæœåŠ¡å™¨æ”¶åˆ°SYNåï¼Œå›å¤ <span class="signal-info">SYN=1, ACK=1</span>ï¼Œç”Ÿæˆåºåˆ—å· <span class="seq-info">seq=y</span>ï¼Œç¡®è®¤å· <span class="seq-info">ack=x+1</span>ï¼Œè¿›å…¥ <span class="state-info">SYN-RCVD</span> çŠ¶æ€</p>
            <p><strong>ç¬¬ä¸‰æ¬¡æ¡æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘é€ <span class="signal-info">ACK=1</span>ï¼Œç¡®è®¤å· <span class="seq-info">ack=y+1</span>ï¼ŒåŒæ–¹è¿›å…¥ <span class="state-info">ESTABLISHED</span> çŠ¶æ€ï¼Œè¿æ¥å»ºç«‹</p>
        </div>

        <h2>ğŸ‘‹ å››æ¬¡æŒ¥æ‰‹ (Four-Way Termination)</h2>
        <p><strong>ç›®çš„</strong>ï¼šå®‰å…¨åœ°å…³é—­è¿æ¥ï¼Œç¡®ä¿åŒæ–¹æ•°æ®ä¼ è¾“å®Œæ¯•</p>
        
        <div class="diagram-container">
            <div class="mermaid">
sequenceDiagram
    participant "å®¢æˆ·ç«¯<br/>Client" as Client
    participant "æœåŠ¡å™¨<br/>Server" as Server
    
    Note over Client,Server: ESTABLISHEDçŠ¶æ€<br/>æ­£å¸¸æ•°æ®ä¼ è¾“ä¸­
    
    Client->>Server: â‘ FIN=1, seq=x<br/>ç»“æŸä¿¡å·+åºåˆ—å·
    Note over Client: FIN-WAIT-1çŠ¶æ€<br/>å·²å‘é€ç»“æŸè¯·æ±‚
    
    Server->>Client: â‘¡ACK=1, ack=x+1<br/>ç¡®è®¤ä¿¡å·
    Note over Server: CLOSE-WAITçŠ¶æ€<br/>å‡†å¤‡å…³é—­ï¼Œå¯èƒ½è¿˜æœ‰æ•°æ®
    Note over Client: FIN-WAIT-2çŠ¶æ€<br/>ç­‰å¾…æœåŠ¡å™¨ç»“æŸä¿¡å·
    
    Note over Server: å‘é€å‰©ä½™æ•°æ®...<br/>Sending remaining data...
    
    Server->>Client: â‘¢FIN=1, seq=y<br/>ç»“æŸä¿¡å·+åºåˆ—å·
    Note over Server: LAST-ACKçŠ¶æ€<br/>ç­‰å¾…æœ€åç¡®è®¤
    
    Client->>Server: â‘£ACK=1, ack=y+1<br/>æœ€ç»ˆç¡®è®¤ä¿¡å·
    Note over Client: TIME-WAITçŠ¶æ€<br/>ç­‰å¾…2MSLåå…³é—­
    Note over Server: CLOSEDçŠ¶æ€<br/>è¿æ¥å…³é—­
    
    Note over Client: ç­‰å¾…2MSLå...<br/>After 2MSL timeout...
    Note over Client: CLOSEDçŠ¶æ€<br/>è¿æ¥å®Œå…¨å…³é—­
            </div>
        </div>

        <div class="step-explanation">
            <h4>ğŸ“‹ å››æ¬¡æŒ¥æ‰‹è¯¦ç»†æ­¥éª¤</h4>
            <p><strong>ç¬¬ä¸€æ¬¡æŒ¥æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘é€ <span class="signal-info">FIN=1</span> ç»“æŸä¿¡å·ï¼Œåºåˆ—å· <span class="seq-info">seq=x</span>ï¼Œè¿›å…¥ <span class="state-info">FIN-WAIT-1</span> çŠ¶æ€</p>
            <p><strong>ç¬¬äºŒæ¬¡æŒ¥æ‰‹</strong>ï¼šæœåŠ¡å™¨å›å¤ <span class="signal-info">ACK=1</span>ï¼Œç¡®è®¤å· <span class="seq-info">ack=x+1</span>ï¼Œè¿›å…¥ <span class="state-info">CLOSE-WAIT</span> çŠ¶æ€ï¼Œæ­¤æ—¶å¯èƒ½è¿˜æœ‰æ•°æ®æœªå‘é€å®Œ</p>
            <p><strong>ç¬¬ä¸‰æ¬¡æŒ¥æ‰‹</strong>ï¼šæœåŠ¡å™¨æ•°æ®å‘é€å®Œæ¯•åï¼Œå‘é€ <span class="signal-info">FIN=1</span>ï¼Œåºåˆ—å· <span class="seq-info">seq=y</span>ï¼Œè¿›å…¥ <span class="state-info">LAST-ACK</span> çŠ¶æ€</p>
            <p><strong>ç¬¬å››æ¬¡æŒ¥æ‰‹</strong>ï¼šå®¢æˆ·ç«¯å‘é€ <span class="signal-info">ACK=1</span>ï¼Œç¡®è®¤å· <span class="seq-info">ack=y+1</span>ï¼Œè¿›å…¥ <span class="state-info">TIME-WAIT</span> çŠ¶æ€ï¼Œç­‰å¾…2MSLåå®Œå…¨å…³é—­</p>
        </div>

        <div class="tcp-intro">
            <h3>ğŸ” å…³é”®æ¦‚å¿µè§£é‡Š (Key Concepts)</h3>
            <p><strong>SYN (Synchronize)</strong>ï¼šåŒæ­¥æ ‡å¿—ä½ï¼Œç”¨äºå»ºç«‹è¿æ¥æ—¶çš„åºåˆ—å·åŒæ­¥</p>
            <p><strong>ACK (Acknowledge)</strong>ï¼šç¡®è®¤æ ‡å¿—ä½ï¼Œç”¨äºç¡®è®¤æ”¶åˆ°çš„æ•°æ®</p>
            <p><strong>FIN (Finish)</strong>ï¼šç»“æŸæ ‡å¿—ä½ï¼Œç”¨äºå…³é—­è¿æ¥</p>
            <p><strong>seq (Sequence Number)</strong>ï¼šåºåˆ—å·ï¼Œæ ‡è¯†æ•°æ®çš„é¡ºåº</p>
            <p><strong>ack (Acknowledgment Number)</strong>ï¼šç¡®è®¤å·ï¼Œè¡¨ç¤ºæœŸæœ›æ”¶åˆ°çš„ä¸‹ä¸€ä¸ªåºåˆ—å·</p>
            <p><strong>MSL (Maximum Segment Lifetime)</strong>ï¼šæŠ¥æ–‡æ®µæœ€å¤§ç”Ÿå­˜æ—¶é—´ï¼Œé€šå¸¸ä¸º2åˆ†é’Ÿ</p>
        </div>
    </div>

    <script>
        mermaid.initialize({
            startOnLoad: true,
            theme: 'default',
            sequence: {
                diagramMarginX: 50,
                diagramMarginY: 10,
                actorMargin: 50,
                width: 150,
                height: 65,
                boxMargin: 10,
                boxTextMargin: 5,
                noteMargin: 10,
                messageMargin: 35,
                mirrorActors: false,
                bottomMarginAdj: 1,
                useMaxWidth: true,
                rightAngles: false,
                showSequenceNumbers: false
            }
        });
    </script>
</body>
</html>
